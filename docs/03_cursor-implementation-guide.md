# Cursor による実装の進め方

このドキュメントは**Cursor を使った実装の進め方**（ルール・仕様書・段階的実装）をまとめています。日々のブランチ戦略や PR・デプロイの手順は [02_development-flow.md](02_development-flow.md) を参照してください。

## 結論

Cursor に正確に実装させる最も確実な方法は、次の **3つを組み合わせるアプローチ** です。

- [x] **プロジェクトルールの定義**（`.cursor/rules/` の .mdc で「絶対的な掟」を記述）
- [x] **`docs/` への仕様書の配置**（採用技術一覧・前提情報を Markdown で保存）
- [x] **Composer（Cmd/Ctrl + I）を用いた段階的な実装**（タスクを分割して指示）

※ ルールの実体は本プロジェクトでは `.cursor/rules/*.mdc` で管理しています。従来の単一ファイル `.cursorrules` はレガシー形式です。

## 理由

AI（Cursor）は強力ですが、システム全体の複雑な要件を一度に口頭（チャット）で伝えると、コンテキストを見失ったり、一般的な（しかし今回の要件とは異なる）ベストプラクティスに引っ張られて意図しないコードを生成する傾向があります。

事前に「絶対的なルール」と「参照すべき仕様書」を物理的なファイルとしてプロジェクト内に配置し、AI が常にそれを読み込める状態（グラウンディング）を作ることが、正確な構成を組み上げる鍵です。

---

## 3ステップ

### 1. ルールの定義（制約の明文化）

プロジェクトのルール（本プロジェクトでは `.cursor/rules/` 配下の .mdc）に、AI に対する「絶対的な掟」を記述します。Cursor はコード生成時に常にこのルールを参照します。

**記述すべき内容の例（本プロジェクトで採用）:**

- [x] バックエンドは Go（`provided.al2023`）で記述し、デプロイには必ず `lambroll` を使用すること
- [x] Terraform の State 管理は S3 ネイティブロック（v1.4 以降）とし、DynamoDB は絶対に使用しないこと
- [x] Lambda 関数の Terraform 定義には `ignore_changes` を設定し、インフラとアプリのデプロイを分離すること
- [x] 静的解析には tflint, trivy, Biome, golangci-lint を使用すること

### 2. 仕様書のドキュメント化（コンテキストの提供）

採用技術一覧や前提情報を、Markdown ファイルとして `docs/` 配下に保存します。

- **例:** [01_tech-stack.md](01_tech-stack.md), [architecture.md](architecture.md)（必要に応じて追加）
- **メリット:** チャットや Composer で `@docs/01_tech-stack.md` とメンションするだけで、AI が仕様を正確に読み込み、構成のブレを防げます。

### 3. Composer による「段階的な」実装（タスクの分割）

すべてを一度に作らせるのではなく、レイヤーごとにタスクを分割して Cursor（Composer 機能）に指示を出します。

| フェーズ | 指示例 |
|----------|--------|
| **フェーズ1（開発環境）** | 「`@docs/01_tech-stack.md` を読み込み、devcontainers と mise を使ったローカル開発環境のボイラープレートを作成して」 |
| **フェーズ2（インフラ基盤）** | 「`@docs/01_tech-stack.md` をもとに、S3 バックエンドと OIDC 用 IAM ロールを定義する Terraform の初期ディレクトリ構造を作って」 |
| **フェーズ3（バックエンド）** | 「`@docs/01_tech-stack.md` をもとに、Go での API Gateway ハンドラーと、デプロイ用の lambroll の設定ファイルを作って」 |
| **フェーズ4（CI/CD）** | 「これまでのコードをもとに、GitHub Actions のワークフロー（分割版）を構築して」 |

---

## 締め

「ルール（.cursor/rules/）」「仕様書（docs/）」「タスク分割」の 3 段構えで Cursor をコントロールすることで、AI の幻覚（ハルシネーション）を防ぎ、技術選定と SRE のベストプラクティスに準拠したインフラ・アプリ基盤をスムーズに構築できます。

---

## 次のステップ

実装を進める際は、次のどちらかから着手できます。

- **ルールの具体化**: Cursor に読み込ませるための、より詳細なルール（.mdc の具体例）の追加
- **インフラ設計**: dev / prod 環境を分離した Terraform の具体的なディレクトリ構成・モジュール分割案の作成

日々の開発手順（ブランチ・PR・デプロイ）は [02_development-flow.md](02_development-flow.md)、技術一覧は [01_tech-stack.md](01_tech-stack.md) を参照してください。フェーズ別の作業手順・ブランチ名・コミット例の詳細は [04_implementation-phases.md](04_implementation-phases.md) を参照し、実装は上記のフェーズ順で段階的に進めてください。
